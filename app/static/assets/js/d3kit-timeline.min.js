"use strict";!function(a,b){"function"==typeof define&&define.amd?define(["d3","d3kit","labella"],b):"object"==typeof exports?module.exports=b(require("d3"),require("d3kit"),require("labella")):a.d3KitTimeline=b(a.d3,a.d3Kit,a.labella)}(this,function(a,b,c){var d={margin:{left:40,right:20,top:20,bottom:20},initialWidth:400,initialHeight:400,scale:a.time.scale(),domain:void 0,direction:"right",dotRadius:3,layerGap:60,labella:{},keyFn:void 0,timeFn:function(a){return a.time},textFn:function(a){return a.text},dotColor:"#222",labelBgColor:"#222",labelTextColor:"#fff",linkColor:"#222",labelPadding:{left:4,right:4,top:3,bottom:2},textYOffset:"0.85em"},e=["dotClick","dotMouseover","dotMousemove","dotMouseout","labelClick","labelMouseover","labelMousemove","labelMouseenter","labelMouseleave","labelMouseout"];return b.factory.createChart(d,e,function(d){function e(a){return a.w}function f(a){return a.h}function g(a){return m.scale(m.timeFn(a))}function h(){var e=d.data()||[];m.domain?m.scale.domain(m.domain):m.scale.domain(a.extent(e,m.timeFn)).nice(),m.scale.range([0,"left"===m.direction||"right"===m.direction?d.getInnerHeight():d.getInnerWidth()]),q.scale(m.scale);var f;switch(m.direction){case"right":q.orient("left"),f="translate(0,0)";break;case"left":q.orient("right"),f="translate("+d.getInnerWidth()+",0)";break;case"up":q.orient("bottom"),f="translate(0,"+d.getInnerHeight()+")";break;case"down":q.orient("top"),f="translate(0,0)"}o.get("main").attr("transform",f),o.get("main.axis").call(q),i(e);var h=b.helper.extend({},m.textStyle);Object.keys(h).forEach(function(b){h[b]=a.functor(h[b])}),h.fill=h.fill||a.functor(m.labelTextColor);var l=o.get("dummy").append("text").classed("label-text",!0),n=e.map(function(a){var b=l.call(k,h,a)[0][0].getBBox(),d=b.width+m.labelPadding.left+m.labelPadding.right,e=b.height+m.labelPadding.top+m.labelPadding.bottom,f=new c.Node(g(a),"left"===m.direction||"right"===m.direction?e:d,a);return f.w=d,f.h=e,f});return l.remove(),p.options(m.labella).nodes(n).compute(),j(p.nodes(),h),d}function i(a){var b=o.get("main.dot").selectAll("circle.dot").data(a,m.keyFn),c="left"===m.direction||"right"===m.direction?"cy":"cx";b.enter().append("circle").classed("dot",!0).on("click",function(a,b){n.dotClick(a,b)}).on("mouseover",function(a,b){n.dotMouseover(a,b)}).on("mousemove",function(a,b){n.dotMousemove(a,b)}).on("mouseout",function(a,b){n.dotMouseout(a,b)}).style("fill",m.dotColor).attr("r",m.dotRadius).attr(c,g),b.transition().style("fill",m.dotColor).attr("r",m.dotRadius).attr(c,g),b.exit().remove()}function j(b,d){function g(a){switch(m.direction){case"right":return"translate("+a.x+","+(a.y-a.dy/2)+")";case"left":return"translate("+(a.x+h-a.w)+","+(a.y-a.dy/2)+")";case"up":return"translate("+(a.x-a.dx/2)+","+a.y+")";case"down":return"translate("+(a.x-a.dx/2)+","+a.y+")"}}var h;h="left"===m.direction||"right"===m.direction?a.max(b,e):a.max(b,f);var i=new c.Renderer({nodeHeight:h,layerGap:m.layerGap,direction:m.direction});i.layout(b);var j=a.functor(m.labelBgColor),l=a.functor(m.linkColor),p=o.get("main.label").selectAll("g.label-g").data(b,m.keyFn?function(a){return m.keyFn(a.data)}:void 0),q=p.enter().append("g").classed("label-g",!0).on("click",function(a,b){n.labelClick(a.data,b)}).on("mouseover",function(a,b){n.labelMouseover(a.data,b)}).on("mousemove",function(a,b){n.labelMousemove(a.data,b)}).on("mouseenter",function(a,b){n.labelMouseenter(a.data,b)}).on("mouseleave",function(a,b){n.labelMouseleave(a.data,b)}).on("mouseout",function(a,b){n.labelMouseout(a.data,b)}).attr("transform",g);q.append("rect").classed("label-bg",!0).attr("rx",2).attr("ry",2).attr("width",e).attr("height",f).style("fill",function(a){return j(a.data)}),q.append("text").classed("label-text",!0).call(k,d,function(a){return a.data});var r=p.transition().attr("transform",g);r.select("rect").attr("width",e).attr("height",f).style("fill",function(a){return j(a.data)}),r.select("text.label-text").call(k,d,function(a){return a.data}),p.exit().remove();var s=o.get("main.link").selectAll("path.link").data(b,m.keyFn?function(a){return m.keyFn(a.data)}:void 0);s.enter().append("path").classed("link",!0).attr("d",function(a){return i.generatePath(a)}).style("stroke",function(a){return l(a.data)}).style("fill","none"),s.transition().style("stroke",function(a){return l(a.data)}).attr("d",function(a){return i.generatePath(a)}),s.exit().remove()}function k(b,c,d){return d=d?a.functor(d):function(a){return a},b.text(function(a){return m.textFn(d(a))}).attr("dy",m.textYOffset).attr("x",m.labelPadding.left).attr("y",m.labelPadding.top),Object.keys(c).forEach(function(a){var e=c[a];b.style(a,function(a,b){return e(d(a),b)})}),b}function l(){var b;switch(m.direction){case"up":b=a.max(p.nodes(),function(a){return Math.abs(a.y)})||0,d.height(b+m.margin.top+m.margin.bottom);break;case"down":b=a.max(p.nodes(),function(a){return Math.abs(a.y+a.dy)})||0,d.height(b+m.margin.top+m.margin.bottom);break;case"left":b=a.max(p.nodes(),function(a){return Math.abs(a.x)})||0,d.width(b+m.margin.left+m.margin.right);break;case"right":b=a.max(p.nodes(),function(a){return Math.abs(a.x+a.dx)})||0,d.width(b+m.margin.left+m.margin.right)}return d}var m=d.options(),n=d.getDispatcher(),o=d.getLayerOrganizer();o.create(["dummy",{main:["axis","link","label","dot"]}]);var p=new c.Force(m.labella),q=a.svg.axis();return n.on("resize",h),n.on("options",h),n.on("data",h),o.get("main.axis").classed("axis",!0),d.mixin({axis:q,visualize:h,resizeToFit:l})})});